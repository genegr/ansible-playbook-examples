# VMware OpenStack Migration

This folder contains the ansible playbooks that demonstrate how to migrate VMs from a vmware vSphere platform to an OpenStack environment, leveraging vVols and volume group handling provided by the Pure Storage Cinder driver.

## Migration workflow description

The utility consists of a single role, in turn made of small tasks meant to be executed as a single workflow. The sequence assumes that the virtual machines to be migrated are backed by a VMFS datastore and in that scenario each VM is migrated (via storage vmotion) to a temporary vVols datastore residing on a Pure Storage FlashArray. At that point each virtual disk of the VM can be imported (or "adopted") into an OpenStack Cinder backend by the means of the Pure Storage Cinder driver. This is accomplished by leveraging the volume group support capability which is available in OpenStack 2025.1 (Epoxy), that allows a seamless adoption of existing volumes on a FlashArray that are contained into a given volume group. For a proper execution of the migration it is important that the temporary vVols datastore is allocated into a storage container (FlashArray Pod - unstretched), so that a clone of the volumes is internally generated by the Pure Storage Cinder driver. That allows for an easy rollback in case it is needed and also simplifies the fine tuning of the migration procedure, as each of the sub-tasks can be executed on a cold copy of the original disks.

## Required modules

In order to use the utility it is necessary to install all the required Python libraries for Community.Vmware,  
## Usage
The Ansible `inventory.ini` inventory file contains a single entry (localhost) and should not need to be changed.
All the involved variables are defined in the `group_vars/all.yaml` file:

| Variable name | Description |
|--|--|
|vcenter_hostname| vcenter hostname/ip address|
|vcenter_username| vcenter account name |
|vcenter_username| vcenter account password (use vault in real use cases)|
|vcenter_validate_certs| disable/enable vcenter certificate checking |
|datacenter| datacenter where the VMs are located |
|pure_fa_url| FlashArray management endpoint |
